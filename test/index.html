<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test Runner</title>
</head>
<body>
  <canvas id="canvas" width="800" height="600"></canvas>
  <script>
    (async () => {
      // Read the “test” you want from the query string:
      const params = new URLSearchParams(window.location.search);
      const testName = params.get('test');
      if (!testName) {
        console.error('No “test” param provided');
        return;
      }

      const version = params.get('pixi-version');
      if (!testName) {
        console.error('No “test” param provided');
        return;
      }

      function loadScript(src) {
        return new Promise((resolve, reject) => {
          const tag = document.createElement('script');
          tag.src = src;
          tag.onload = () => resolve();
          tag.onerror = () => reject(new Error(`Failed to load ${src}`));
          document.head.appendChild(tag);
        });
      }

      console.log({ testName, version })
      await loadScript(`tests/v${version}/pixi.min.js`)

      // Dynamically import your built script:
      // e.g. it lives at /dist/tests/<testName>.js
      try {
        await import(`/dist/tests/${testName}.js`);
        // assume each module calls a global “runTest(canvas)” function,
        // or exports one that you can call:
        if (window.runTest) {
          await window.runTest(document.getElementById('my-canvas'));
          window.__testDone = true;
        } else {
          console.error('runTest not defined by module');
        }
      } catch (e) {
        console.error('Failed to load test module', e);
      }
    })();
  </script>
</body>
</html>
